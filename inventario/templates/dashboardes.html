{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Escuela - Luth Inv.</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/dashboardes.css' %}">
    <script src="{% static 'js/dashboardes.js' %}"></script>

<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="logo-area">
                <i class="fas fa-school"></i>
                <div class="logo-text">
                    <h1>Luth Inv. Escuela</h1>
                    <p>Sistema de Inventario Escolar</p>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">E</div>
                <div class="user-details">
                    <h3 id="userName">Escuela Primaria Norte</h3>
                    <p id="userRole">Directora</p>
                </div>
                <form action="{% url "logout" %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Cerrar Sesi칩n</span>
                    </button>
                </form>
            </div>
        </header>
        
        <main class="dashboard-main">
            <nav class="dashboard-sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li><a href="#" data-section="inventario"><i class="fas fa-box"></i> <span>Mi Inventario</span></a></li>
                    <li><a href="#" data-section="pedidos"><i class="fas fa-shopping-cart"></i> <span>Pedir Inventario</span></a></li>
                    <li><a href="#" data-section="alertas"><i class="fas fa-exclamation-triangle"></i> <span>Alertas</span></a></li>
                    <li><a href="#" data-section="reportes"><i class="fas fa-chart-bar"></i> <span>Reportes</span></a></li>
                </ul>
            </nav>
            
            <section class="dashboard-content">
                <!-- Secci칩n Dashboard (por defecto) -->
                <div id="section-dashboard" class="dashboard-section active">
                    <div class="welcome-message">
                        <div class="welcome-text">
                            <h3 id="welcomeTitle">Bienvenido al Dashboard Escolar</h3>
                            <p id="welcomeDetail">Gestiona el inventario de tu escuela de manera eficiente.</p>
                        </div>
                        <div class="welcome-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    
                    <div class="content-header">
                        <div>
                            <h2>Resumen de Inventario</h2>
                            <span class="school-badge" id="schoolBadge">Escuela Primaria Norte</span>
                        </div>
                        <div class="date-display" id="currentDate">Cargando fecha...</div>
                    </div>
                    
                    <div class="alerts-container" id="alertsContainer">
                        <div class="alerts-header">
                            <i class="fas fa-exclamation-circle"></i>
                            <h3>Alertas Activas</h3>
                        </div>
                        <div id="alertsList">
                            <!-- Las alertas se cargar치n din치micamente -->
                        </div>
                    </div>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalProducts">{{ materiales.count}}</h3>
                                <p>Total de Productos</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="inStockProducts">{{ total_stock }}</h3>
                                <p>Productos en Stock</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="lowStockProducts">0</h3>
                                <p>Bajo Stock</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="outOfStockProducts">0</h3>
                                <p>Productos Agotados</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="section-container">
                        <div class="section-header">
                            <h3>Productos con Bajo Stock (Necesitan Atenci칩n)</h3>
                            <button class="section-action" id="requestAllBtn">
                                <i class="fas fa-cart-plus"></i>
                                <span>Solicitar Todos</span>
                            </button>
                        </div>
                        <table id="lowStockTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Categor칤a</th>
                                    <th>Cantidad Actual</th>
                                    <th>M칤nimo Requerido</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockTableBody">
                                <!-- Los productos se cargar치n din치micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Secci칩n Mi Inventario -->
                <div id="section-inventario" class="dashboard-section">
                    <div class="content-header">
                        <h2>Mi Inventario Escolar</h2>
                        <button class="section-action" id="exportInventoryBtn">
                            <i class="fas fa-file-export"></i>
                            <span>Exportar Inventario</span>
                        </button>
                    </div>
                    
                    <div class="section-container">
                        <div class="section-header">
                            <h3>Todos los Productos</h3>
                            <div>
                                <input type="text" id="searchInventory" placeholder="Buscar producto..." style="padding: 8px; border: 2px solid #e1e8ed; border-radius: 6px; margin-right: 10px;">
                                <button class="section-action" id="refreshInventoryBtn">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Actualizar</span>
                                </button>
                            </div>
                        </div>
                        <table id="inventoryTable">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Categor칤a</th>
                                    <th>Cantidad</th>
                                    <th>Ubicaci칩n</th>
                                    <th>M칤nimo</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Los productos se cargar치n din치micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
<!-- Secci칩n Pedir Inventario -->
<div id="section-pedidos" class="dashboard-section">
    <div class="content-header">
        <h2>Realizar Pedido de Inventario</h2>
    </div>
    
    <div class="section-container">
        <div class="section-header">
            <h3>Nuevo Pedido</h3>
            <button class="section-action" id="showOrderHistoryBtn">
                <i class="fas fa-history"></i>
                <span>Ver Historial</span>
            </button>
        </div>
        
        <form id="orderForm" class="order-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="orderProduct">Producto</label>
                    <select id="orderProduct" required>
                        <option value="">Seleccionar producto...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="orderQuantity">Cantidad</label>
                    <input type="number" id="orderQuantity" min="1" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="orderPriority">Prioridad</label>
                    <select id="orderPriority" required>
                        <option value="baja">Baja</option>
                        <option value="media">Media</option>
                        <option value="alta">Alta</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="orderNeededBy">Necesario para</label>
                    <input type="date" id="orderNeededBy" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="orderNotes">Notas adicionales</label>
                <textarea id="orderNotes" rows="3" placeholder="Agrega cualquier informaci칩n adicional sobre este pedido..."></textarea>
            </div>
            
            <div class="form-buttons">
                <button type="button" class="btn-cancel" id="cancelOrderBtn">Cancelar</button>
                <button type="submit" class="btn-submit">Enviar Pedido</button>
            </div>
        </form>
        
        <button class="section-action" id="newOrderBtn" style="width: 100%;">
            <i class="fas fa-plus-circle"></i>
            <span>Crear Nuevo Pedido</span>
        </button>
    </div>
    
    <div class="section-container">
        <div class="section-header">
            <h3>Pedidos Pendientes</h3>
        </div>
        <table id="pendingOrdersTable">
            <thead>
                <tr>
                    <th>ID Pedido</th>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Prioridad</th>
                    <th>Fecha Solicitud</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody id="pendingOrdersTableBody">
                <!-- Los pedidos se cargar치n din치micamente -->
            </tbody>
        </table>
    </div>
</div>
                
                <!-- Secci칩n Alertas -->
                <div id="section-alertas" class="dashboard-section">
                    <div class="content-header">
                        <h2>Gesti칩n de Alertas</h2>
                    </div>
                    
                    <div class="section-container">
                        <div class="section-header">
                            <h3>Configurar Alertas de Stock</h3>
                            <button class="section-action" id="configureAlertsBtn">
                                <i class="fas fa-cog"></i>
                                <span>Configurar</span>
                            </button>
                        </div>
                        <p>Configura umbrales para recibir alertas cuando el inventario est칠 bajo.</p>
                        
                        <div style="margin-top: 20px;">
                            <h4>Umbrales Actuales:</h4>
                            <ul id="currentThresholds" style="margin-top: 10px; padding-left: 20px;">
                                <!-- Los umbrales se cargar치n din치micamente -->
                            </ul>
                        </div>
                    </div>
                    
                    <div class="section-container">
                        <div class="section-header">
                            <h3>Historial de Alertas</h3>
                            <button class="section-action" id="clearAlertsBtn">
                                <i class="fas fa-trash-alt"></i>
                                <span>Limpiar Historial</span>
                            </button>
                        </div>
                        <table id="alertsHistoryTable">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Producto</th>
                                    <th>Mensaje</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="alertsHistoryTableBody">
                                <!-- El historial se cargar치 din치micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
<!-- Secci칩n Reportes - Mejorada -->
<div id="section-reportes" class="dashboard-section">
    <div class="content-header">
        <h2><i class="fas fa-chart-bar"></i> Reportes e Informes</h2>
        <div class="date-display" id="reportDate"></div>
    </div>
    
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon blue">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalMaterialesReport">0</h3>
                <p>Materiales en Inventario</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon green">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalMovimientosReport">0</h3>
                <p>Movimientos</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon orange">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalPedidosReport">0</h3>
                <p>Pedidos Realizados</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon red">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalAlertasReport">0</h3>
                <p>Alertas Registradas</p>
            </div>
        </div>
    </div>
    
    <div class="section-container">
        <div class="section-header">
            <h3><i class="fas fa-file-pdf"></i> Generar Nuevo Reporte</h3>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="reportType">Tipo de Reporte</label>
                <select id="reportType" class="form-control">
                    <option value="inventario">游닍 Inventario Actual</option>
                    <option value="consumo">游늵 Consumo Mensual</option>
                    <option value="pedidos">游늶 Historial de Pedidos</option>
                    <option value="alertas">丘멆잺 Reporte de Alertas</option>
                </select>
            </div>
            <div class="form-group">
                <label for="reportPeriod">Per칤odo</label>
                <select id="reportPeriod" class="form-control">
                    <option value="mes">칔ltimo Mes</option>
                    <option value="trimestre">칔ltimo Trimestre</option>
                    <option value="semestre">칔ltimo Semestre</option>
                    <option value="anual">칔ltimo A침o</option>
                </select>
            </div>
        </div>
        <div class="form-buttons" style="margin-top: 20px;">
            <button class="btn-submit" id="generateReportBtn">
                <i class="fas fa-download"></i> Generar Reporte
            </button>
            <button class="btn-cancel" id="exportReportBtn">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
        </div>
    </div>
</div>
            </section>
        </main>
        
        <footer class="dashboard-footer">
            <div class="footer-content">
                <div class="footer-copyright">
                    춸 2023 Luth Inv. - Sistema de Inventario Escolar. Todos los derechos reservados.
                </div>
                <div class="footer-links">
                    <a href="#">Soporte Escolar</a>
                    <a href="#">Gu칤as de Uso</a>
                    <a href="#">Contactar Administrador</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal para alertas -->
    <div class="alert-modal" id="alertModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Crear Alerta Manual</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Contenido din치mico del modal -->
            </div>
        </div>
    </div>

    <!-- Modal para detalles -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detalles</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Contenido din치mico del modal -->
            </div>
        </div>
    </div>

    <!-- Modal para confirmaci칩n -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmModalTitle">Confirmar Acci칩n</h3>
                <button class="modal-close" id="confirmModalClose">&times;</button>
            </div>
            <div id="confirmModalContent">
                <!-- Contenido din치mico del modal -->
            </div>
            <div class="form-buttons" style="margin-top: 20px;">
                <button type="button" class="btn-cancel" id="confirmCancelBtn">Cancelar</button>
                <button type="button" class="btn-submit" id="confirmActionBtn">Confirmar</button>
            </div>
        </div>
    </div>
<!-- Pasar datos de Django a JavaScript -->
<script>
    window.userData = {
        id: {{ user.id }},
        username: "{{ user.username|escapejs }}",
        first_name: "{{ user.first_name|escapejs }}",
        last_name: "{{ user.last_name|escapejs }}",
        email: "{{ user.email|escapejs }}",
        rol: "{{ user.rol|escapejs }}",
        rol_display: "{{ user.get_rol_display|escapejs }}",
        escuela_id: "{{ user.admin_of.id|default:'' }}",
        escuela_nombre: "{{ user.admin_of.name|escapejs|default:'' }}"
    };
    console.log("Datos de usuario escuela:", window.userData);
</script>


<!-- Cargar el JS despu칠s de los datos -->
<script src="{% static 'js/dashboardes.js' %}"></script>
    <!-- Formulario oculto para logout -->
<form id="logoutForm" action="{% url 'logout' %}" method="post" style="display: none;">
    {% csrf_token %}
</form>

<!-- Modal de Confirmaci칩n Moderno -->
<div class="modal-overlay" id="confirmModalModerno">
    <div class="modal-moderno">
        <div class="modal-header-moderno">
            <h3><i class="fas fa-question-circle"></i> Confirmar Acci칩n</h3>
            <button class="modal-close-moderno" id="closeConfirmModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon warning">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <p id="confirmModalMessage">쮼st치s seguro de realizar esta acci칩n?</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno secondary" id="cancelConfirmBtn">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-moderno danger" id="acceptConfirmBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>

<!-- Modal de 칄xito Moderno -->
<div class="modal-overlay" id="successModalModerno">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
            <h3><i class="fas fa-check-circle"></i> 춰Operaci칩n Exitosa!</h3>
            <button class="modal-close-moderno" id="closeSuccessModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <p id="successModalMessage">La operaci칩n se complet칩 correctamente.</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno success" id="acceptSuccessBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Error Moderno -->
<div class="modal-overlay" id="errorModalModerno">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
            <h3><i class="fas fa-exclamation-circle"></i> Error</h3>
            <button class="modal-close-moderno" id="closeErrorModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon error">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <p id="errorModalMessage">Ha ocurrido un error.</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno secondary" id="acceptErrorBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>
<!-- Modal Moderno para Reportes -->
<div class="modal-overlay" id="reporteModal" style="display: none;">
    <div class="modal-moderno" style="max-width: 800px; width: 90%;">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
            <h3><i class="fas fa-chart-bar"></i> <span id="reporteModalTitle">Reporte</span></h3>
            <button class="modal-close-moderno" id="closeReporteModal">&times;</button>
        </div>
        <div class="modal-body-moderno" id="reporteModalContent" style="max-height: 500px; overflow-y: auto; padding: 20px;">
            <!-- Contenido del reporte -->
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno secondary" id="exportarReporteBtn">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
            <button class="btn-moderno primary" id="cerrarReporteBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Confirmaci칩n Moderno -->
<div class="modal-overlay" id="confirmModalModerno" style="display: none;">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
            <h3><i class="fas fa-question-circle"></i> Confirmar Acci칩n</h3>
            <button class="modal-close-moderno" id="closeConfirmModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon warning">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <p id="confirmModalMessage">쮼st치s seguro de realizar esta acci칩n?</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno secondary" id="cancelConfirmBtn">
                <i class="fas fa-times"></i> Cancelar
            </button>
            <button class="btn-moderno danger" id="acceptConfirmBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>

<!-- Modal de 칄xito Moderno -->
<div class="modal-overlay" id="successModalModerno" style="display: none;">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
            <h3><i class="fas fa-check-circle"></i> 춰Operaci칩n Exitosa!</h3>
            <button class="modal-close-moderno" id="closeSuccessModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <p id="successModalMessage">La operaci칩n se complet칩 correctamente.</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno success" id="acceptSuccessBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>

<!-- Modal de Error Moderno -->
<div class="modal-overlay" id="errorModalModerno" style="display: none;">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
            <h3><i class="fas fa-exclamation-circle"></i> Error</h3>
            <button class="modal-close-moderno" id="closeErrorModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon error">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <p id="errorModalMessage">Ha ocurrido un error.</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno secondary" id="acceptErrorBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>
<!-- Modal de Informaci칩n Moderno -->
<div class="modal-overlay" id="infoModalModerno">
    <div class="modal-moderno">
        <div class="modal-header-moderno" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
            <h3><i class="fas fa-info-circle"></i> Informaci칩n</h3>
            <button class="modal-close-moderno" id="closeInfoModal">&times;</button>
        </div>
        <div class="modal-body-moderno">
            <div class="modal-icon info">
                <i class="fas fa-info-circle"></i>
            </div>
            <p id="infoModalMessage">Mensaje informativo.</p>
        </div>
        <div class="modal-footer-moderno">
            <button class="btn-moderno info" id="acceptInfoBtn">
                <i class="fas fa-check"></i> Aceptar
            </button>
        </div>
    </div>
</div>
</body>
</html>