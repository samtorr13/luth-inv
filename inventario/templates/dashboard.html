{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Luth Inv.</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <style>
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-in-stock {
            background-color: #d4edda;
            color: #155724;
        }
        .status-low-stock {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-out-of-stock {
            background-color: #f8d7da;
            color: #721c24;
        }
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-input,
        .filter-select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }
        .section-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th {
            text-align: left;
            padding: 12px;
            background-color: #f8f9fa;
            font-weight: 600;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
        }
        .action-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .action-btn.edit {
            background-color: #007bff;
            color: white;
        }
        .action-btn.delete {
            background-color: #dc3545;
            color: white;
        }
        .action-btn.view {
            background-color: #6c757d;
            color: white;
        }
        .btn-action {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        .btn-action.primary {
            background-color: #007bff;
            color: white;
        }
        .btn-action.secondary {
            background-color: #6c757d;
            color: white;
        }
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-submit {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-cancel {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="logo-area">
                <i class="fas fa-boxes"></i>
                <div class="logo-text">
                    <h1>Luth Inv.</h1>
                    <p>Sistema de Inventario</p>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar" id="userAvatar">{{ user.first_name|first|default:'A' }}</div>
                <div class="user-details">
                    <h3 id="userName">{{ user.first_name }} {{ user.last_name }}</h3>
                    <p id="userRole">
                        {% if user.rol == 'ADMIN' %}
                            Administrador del Sistema
                            {% if user.admin_of %}de {{ user.admin_of.name }}{% endif %}
                        {% else %}
                            Usuario
                        {% endif %}
                    </p>
                </div>

                <form action="{% url 'logout' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Cerrar Sesi√≥n</span>
                    </button>
                </form>
            </div>
        </header>

        <main class="dashboard-main">
            <nav class="dashboard-sidebar">
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                    <li><a href="#" data-section="inventario"><i class="fas fa-box"></i> <span>Inventario</span></a></li>
                    <li><a href="#" data-section="categorias"><i class="fas fa-list"></i> <span>Tipos de Material</span></a></li>
                    <li><a href="#" data-section="pedidos"><i class="fas fa-shopping-cart"></i> <span>Pedidos</span></a></li>
                    <li><a href="#" data-section="reportes"><i class="fas fa-chart-bar"></i> <span>Reportes</span></a></li>
                    <li><a href="#" data-section="usuarios"><i class="fas fa-users"></i> <span>Usuarios</span></a></li>
                    <li><a href="#" data-section="escuelas"><i class="fas fa-school"></i> <span>Escuelas</span></a></li>
                    <li><a href="#" data-section="configuracion"><i class="fas fa-cogs"></i> <span>Configuraci√≥n</span></a></li>
                </ul>
            </nav>

            <section class="dashboard-content">
                <!-- ============================================ -->
                <!-- SECCI√ìN DASHBOARD (INICIO) -->
                <!-- ============================================ -->
                <div id="section-dashboard" class="dashboard-section active">
                    <div class="welcome-message">
                        <div class="welcome-text">
                            <h3>Bienvenido al Dashboard de Luth Inv.</h3>
                            <p id="welcomeDetail">Gestiona el inventario de todas las escuelas de manera centralizada.</p>
                        </div>
                        <div class="welcome-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>

                    <div class="content-header">
                        <h2>Resumen General del Sistema</h2>
                        <div class="date-display" id="currentDate"></div>
                    </div>

                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalSchools">{{ total_escuelas|default:0 }}</h3>
                                <p>Escuelas Activas</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalProducts">{{ total_materiales|default:0 }}</h3>
                                <p>Materiales Totales</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendingOrders">{{ estadisticas.pedidos_pendientes|default:0 }}</h3>
                                <p>Pedidos Pendientes</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="criticalAlerts">{{ alertas_criticas|default:0 }}</h3>
                                <p>Alertas Cr√≠ticas</p>
                            </div>
                        </div>
                    </div>

                    <div class="section-container">
                        <div class="section-header">
                            <h3>Alertas Recientes</h3>
                            <div class="section-actions">
                                <button class="btn-action secondary" id="markAllReadBtn">
                                    <i class="fas fa-check-double"></i>
                                    <span>Marcar Todas como Le√≠das</span>
                                </button>
                            </div>
                        </div>

                        <div id="alertsList">
                            {% for alerta in recent_alerts %}
                                <div class="alert-item"
                                    style="padding: 10px; margin: 5px 0; background-color: #f8d7da; border-left: 4px solid #dc3545; border-radius: 4px;">
                                    <strong>Alerta #{{ alerta.id }}:</strong> {{ alerta.msg }}
                                    <br>
                                    <small>{{ alerta.inv.name }} - {{ alerta.fecha|date:"d/m/Y H:i" }}</small>
                                </div>
                            {% empty %}
                                <p style="text-align: center; padding: 20px; color: #6c757d;">No hay alertas pendientes</p>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="section-container">
                        <div class="section-header">
                            <h3>Pedidos Pendientes por Aprobar</h3>
                            <button class="btn-action secondary" id="viewAllOrdersBtn">
                                <i class="fas fa-list"></i>
                                <span>Ver Todos</span>
                            </button>
                        </div>
                        <table id="pendingOrdersTable">
                            <thead>
                                <tr>
                                    <th>ID Pedido</th>
                                    <th>Escuela</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Prioridad</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pendingOrdersTableBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 20px; color: #6c757d;">
                                        M√≥dulo de pedidos en desarrollo
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Distribuci√≥n de Materiales por Tipo</div>
                        <div class="chart-placeholder" id="inventoryChart">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; opacity: 0.5;"></i>
                            <span style="margin-left: 15px;">
                                {% for tipo, count in materiales_por_tipo.items %}
                                    {{ tipo }}: {{ count }} materiales<br>
                                {% endfor %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCI√ìN INVENTARIO - CORREGIDA CON DATOS REALES -->
                <!-- ============================================ -->
                <div id="section-inventario" class="dashboard-section">
                    <div class="content-header">
                        <h2>Gesti√≥n de Inventario</h2>
                        <div class="header-actions">
                            <button class="btn-action secondary" id="exportInventoryBtn">
                                <i class="fas fa-file-export"></i>
                                <span>Exportar</span>
                            </button>
                            <button class="btn-action primary" id="addProductBtn">
                                <i class="fas fa-plus"></i>
                                <span>Agregar Material</span>
                            </button>
                        </div>
                    </div>

                    <div class="filter-bar">
                        <input type="text" id="searchInventory" class="filter-input"
                            placeholder="Buscar material por nombre o tipo...">
                        <select id="filterCategory" class="filter-select">
                            <option value="">Todos los tipos</option>
                            {% for tipo_value, tipo_label in material.Tipo.choices %}
                                <option value="{{ tipo_value }}">{{ tipo_label }}</option>
                            {% endfor %}
                        </select>
                        <select id="filterSchool" class="filter-select">
                            <option value="">Todas las escuelas</option>
                            {% for escuela in escuelas %}
                                <option value="{{ escuela.id }}">{{ escuela.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

<!-- Tabla de Materiales - CON UBICACIONES VISIBLES -->
<div class="section-container">
    <table id="inventoryTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Material</th>
                <th>Tipo</th>
                <th>Unidad</th>
                <th>Descripci√≥n</th>
                <th>Ubicaciones (Escuela/Dep√≥sito)</th>
                <th>Stock Total</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="inventoryTableBody">
            {% for material in materiales %}
                <tr>
                    <td><span class="badge">MAT{{ material.id }}</span></td>
                    <td><strong>{{ material.name }}</strong></td>
                    <td>{{ material.get_tipo_display }}</td>
                    <td>{{ material.get_unidad_display }}</td>
                    <td>{{ material.desc|default:"-"|truncatechars:50 }}</td>
                    <td>
                        <!-- Aqu√≠ van las ubicaciones del material -->
                        <div style="display: flex; flex-direction: column; gap: 5px;">
                            {% for stock in stocks %}
                                {% if stock.mat.id == material.id %}
                                    <div style="display: flex; align-items: center; gap: 5px; background-color: #f8f9fa; padding: 3px 6px; border-radius: 4px;">
                                        {% if stock.inv.es_depo %}
                                            <i class="fas fa-warehouse" style="color: #17a2b8;" title="Dep√≥sito"></i>
                                        {% else %}
                                            <i class="fas fa-school" style="color: #28a745;" title="Escuela"></i>
                                        {% endif %}
                                        <span style="flex: 1;">{{ stock.inv.name }}</span>
                                        <span style="font-weight: 600; color: #007bff;">{{ stock.mat_qty }}</span>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            
                            <!-- Si no hay stocks, mostrar mensaje -->
                            {% if not stocks|dictsort:"mat.id"|length %}
                                <span style="color: #6c757d; font-style: italic;">Sin ubicaci√≥n</span>
                            {% endif %}
                        </div>
                    </td>
                    <td style="text-align: center;">
                        <span style="font-size: 1.2rem; font-weight: 700; color: #007bff;">{{ material.stock_total|default:0 }}</span>
                        <br>
                        <small style="color: #6c757d;">Min: {{ material.stock_minimo|default:5 }}</small>
                    </td>
                    <td>
                        {% if material.stock_total == 0 %}
                            <span class="status-badge status-out-of-stock">
                                <i class="fas fa-times-circle"></i> Agotado
                            </span>
                        {% elif material.stock_total < material.stock_minimo %}
                            <span class="status-badge status-low-stock">
                                <i class="fas fa-exclamation-triangle"></i> Bajo Stock
                            </span>
                        {% else %}
                            <span class="status-badge status-in-stock">
                                <i class="fas fa-check-circle"></i> En Stock
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="action-btn edit" data-id="{{ material.id }}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete" data-id="{{ material.id }}" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="action-btn view" data-id="{{ material.id }}" title="Ver detalles">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9" style="text-align: center; padding: 40px;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: #dee2e6;"></i>
                        <h3 style="color: #6c757d;">No hay materiales registrados</h3>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- Tabla de Stock por Escuela - VERSI√ìN SIMPLE Y CONFIABLE -->
<div class="section-container" style="margin-top: 30px;">
    <div class="section-header">
        <h3><i class="fas fa-warehouse"></i> Stock por Escuela</h3>
        <button class="btn-action secondary" id="refreshStockBtn">
            <i class="fas fa-sync-alt"></i>
            <span>Actualizar</span>
        </button>
    </div>
    
<!-- Stock por Escuela - CON FUNCIONALIDAD DE AGREGAR Y MODIFICAR -->
<div class="section-container" style="margin-top: 30px;">
    
    
    <!-- Contenedor de stock por escuela -->
    <div id="stocksPorEscuela">
        {% for escuela in escuelas %}
            <div class="escuela-stock-card" data-escuela-id="{{ escuela.id }}" style="margin-bottom: 30px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow: hidden;">
                <!-- Cabecera de la escuela con bot√≥n AGREGAR -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-school" style="font-size: 1.8rem; color: white;"></i>
                        <div>
                            <h4 style="margin: 0; color: white; font-size: 1.3rem;">{{ escuela.name }}</h4>
                            <p style="margin: 5px 0 0; color: rgba(255,255,255,0.8); font-size: 0.9rem;">
                                <i class="fas fa-map-marker-alt"></i> {{ escuela.ubic|default:"Ubicaci√≥n no especificada" }}
                            </p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; color: white;">
                            <i class="fas fa-cubes"></i> <span class="total-items-{{ escuela.id }}">0</span>
                        </div>
                        <button class="btn-action agregar-stock" data-escuela-id="{{ escuela.id }}" data-escuela-nombre="{{ escuela.name }}" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-plus"></i> Agregar Material
                        </button>
                    </div>
                </div>
                
                <!-- Tabla de stock de la escuela -->
                <div style="padding: 20px;">
                    <table class="stock-escuela-table" data-escuela-id="{{ escuela.id }}" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Material</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Cantidad</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">M√≠nimo</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Estado</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Ubicaci√≥n</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #dee2e6;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="stock-tbody-{{ escuela.id }}">
                            <!-- Los stocks se cargar√°n aqu√≠ din√°micamente -->
                        </tbody>
                    </table>
                    
                    <div id="stock-empty-{{ escuela.id }}" style="text-align: center; padding: 40px; color: #6c757d; display: none;">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 10px;"></i>
                        <p>No hay materiales registrados en esta escuela</p>
                        <button class="btn-action agregar-stock" data-escuela-id="{{ escuela.id }}" data-escuela-nombre="{{ escuela.name }}" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            <i class="fas fa-plus"></i> Agregar Material
                        </button>
                    </div>
                </div>
            </div>
        {% empty %}
            <!-- Si no hay ninguna escuela -->
            <div style="text-align: center; padding: 60px 20px; background: white; border-radius: 10px;">
                <i class="fas fa-warehouse" style="font-size: 4rem; color: #dee2e6; margin-bottom: 20px;"></i>
                <h3 style="color: #6c757d; margin-bottom: 10px;">No hay escuelas registradas</h3>
                <p style="color: #adb5bd;">Agrega una escuela para comenzar a gestionar el stock</p>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Modal para Agregar/Editar Stock -->
<div class="modal" id="stockModal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h3 id="stockModalTitle">Agregar Material a Escuela</h3>
            <button class="modal-close" id="stockModalClose">&times;</button>
        </div>
        <div id="stockModalContent">
            <form id="stockForm">
                <input type="hidden" id="stockId" name="stockId" value="">
                <input type="hidden" id="escuelaId" name="escuelaId" value="">
                
                <div class="form-group">
                    <label for="materialSelect">Material *</label>
                    <select id="materialSelect" name="material_id" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                        <option value="">Seleccionar material</option>
                        {% for material in materiales %}
                            <option value="{{ material.id }}">{{ material.name }} ({{ material.get_tipo_display }})</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-row" style="display: flex; gap: 15px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="stockCantidad">Cantidad *</label>
                        <input type="number" id="stockCantidad" name="cantidad" min="0" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                    </div>
                    
                    <div class="form-group" style="flex: 1;">
                        <label for="stockMinimo">M√≠nimo *</label>
                        <input type="number" id="stockMinimo" name="minimo" min="1" required style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                    </div>
                </div>
                
                <div class="form-buttons" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn-cancel" id="cancelStockBtn">Cancelar</button>
                    <button type="submit" class="btn-submit" id="saveStockBtn">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>
</div>

                    <!-- Formulario para agregar/editar material -->
                    <div class="form-container" id="productForm" style="display: none;">
                        <h3 id="productFormTitle">Agregar Nuevo Material</h3>
                        <form id="productFormElement" method="post" action="#">
                            {% csrf_token %}
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="productName">Nombre del Material *</label>
                                    <input type="text" id="productName" name="name" required maxlength="40">
                                </div>
                                <div class="form-group">
                                    <label for="productTipo">Tipo de Material *</label>
                                    <select id="productTipo" name="tipo" required>
                                        <option value="">Seleccionar tipo</option>
                                        {% for tipo_value, tipo_label in material.Tipo.choices %}
                                            <option value="{{ tipo_value }}">{{ tipo_label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="productUnidad">Unidad de Medida *</label>
                                    <select id="productUnidad" name="unidad" required>
                                        <option value="">Seleccionar unidad</option>
                                        {% for unidad_value, unidad_label in material.Unidad.choices %}
                                            <option value="{{ unidad_value }}">{{ unidad_label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="productDesc">Descripci√≥n</label>
                                    <input type="text" id="productDesc" name="desc" maxlength="150">
                                </div>
                            </div>

                            <div class="form-buttons">
                                <button type="button" class="btn-cancel" id="cancelProductBtn">Cancelar</button>
                                <button type="submit" class="btn-submit" id="saveProductBtn">Guardar Material</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCI√ìN CATEGOR√çAS (TIPOS DE MATERIAL) - VERSI√ìN SIMPLIFICADA -->
                <!-- ============================================ -->
                <div id="section-categorias" class="dashboard-section">
                    <div class="content-header">
                        <h2>Tipos de Material</h2>
                        <button class="btn-action primary" id="addCategoryBtn">
                            <i class="fas fa-plus"></i>
                            <span>Nuevo Tipo</span>
                        </button>
                    </div>

                    <div class="section-container">
                        <table id="categoriesTable">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Descripci√≥n</th>
                                    <th>Materiales</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <tr>
                                    <td>MADERA</td>
                                    <td>Maderas y Trozos</td>
                                    <td>Materiales de tipo MADERA</td>
                                    <td>{{ materiales_por_tipo.MADERA|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                                <tr>
                                    <td>BARNIZ</td>
                                    <td>Barnices y Pinturas</td>
                                    <td>Materiales de tipo BARNIZ</td>
                                    <td>{{ materiales_por_tipo.BARNIZ|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                                <tr>
                                    <td>HERRAJE</td>
                                    <td>Herrajes y Piezas</td>
                                    <td>Materiales de tipo HERRAJE</td>
                                    <td>{{ materiales_por_tipo.HERRAJE|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                                <tr>
                                    <td>CUERDAS</td>
                                    <td>Cuerdas</td>
                                    <td>Materiales de tipo CUERDAS</td>
                                    <td>{{ materiales_por_tipo.CUERDAS|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                                <tr>
                                    <td>HERRAMIENTA</td>
                                    <td>Herramientas</td>
                                    <td>Materiales de tipo HERRAMIENTA</td>
                                    <td>{{ materiales_por_tipo.HERRAMIENTA|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                                <tr>
                                    <td>OTRO</td>
                                    <td>Otros</td>
                                    <td>Materiales de tipo OTRO</td>
                                    <td>{{ materiales_por_tipo.OTRO|default:"0" }}</td>
                                    <td><button class="action-btn view">Ver</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
<!-- ============================================ -->
<!-- SECCI√ìN PEDIDOS - GESTI√ìN PARA ADMIN -->
<!-- ============================================ -->
<div id="section-pedidos" class="dashboard-section">
    <div class="content-header">
        <h2><i class="fas fa-shopping-cart"></i> Gesti√≥n de Pedidos</h2>
        <div class="header-actions">
            <button class="btn-action secondary" id="refreshPedidosBtn">
                <i class="fas fa-sync-alt"></i> Actualizar
            </button>
        </div>
    </div>
    
    <!-- Tarjetas de estad√≠sticas -->
    <div class="stats-cards" style="margin-bottom: 20px;">
        <div class="stat-card" style="cursor: pointer;" onclick="filtrarPedidos('pendiente')">
            <div class="stat-icon orange">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-info">
                <h3 id="pendientesCount">0</h3>
                <p>Pendientes</p>
            </div>
        </div>
        
        <div class="stat-card" style="cursor: pointer;" onclick="filtrarPedidos('aprobado')">
            <div class="stat-icon green">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="aprobadosCount">0</h3>
                <p>Aprobados</p>
            </div>
        </div>
        
        <div class="stat-card" style="cursor: pointer;" onclick="filtrarPedidos('rechazado')">
            <div class="stat-icon red">
                <i class="fas fa-times-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="rechazadosCount">0</h3>
                <p>Rechazados</p>
            </div>
        </div>
        
        <div class="stat-card" style="cursor: pointer;" onclick="filtrarPedidos('entregado')">
            <div class="stat-icon blue">
                <i class="fas fa-truck"></i>
            </div>
            <div class="stat-info">
                <h3 id="entregadosCount">0</h3>
                <p>Entregados</p>
            </div>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="filter-bar" style="margin-bottom: 20px;">
        <select id="estadoFilter" class="filter-select" style="flex: 1;">
            <option value="">Todos los estados</option>
            <option value="pendiente">‚è≥ Pendientes</option>
            <option value="aprobado">‚úÖ Aprobados</option>
            <option value="rechazado">‚ùå Rechazados</option>
            <option value="entregado">üì¶ Entregados</option>
        </select>
        
        <select id="escuelaFilter" class="filter-select" style="flex: 1;">
            <option value="">Todas las escuelas</option>
            {% for escuela in escuelas %}
                <option value="{{ escuela.id }}">{{ escuela.name }}</option>
            {% endfor %}
        </select>
        
        <input type="text" id="searchPedidos" class="filter-input" placeholder="Buscar por material o escuela..." style="flex: 2;">
    </div>
    
    <!-- Tabla de pedidos -->
    <div class="section-container" style="padding: 0; overflow: hidden;">
        <div style="overflow-x: auto;">
            <table id="pedidosTable" style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                        <th style="padding: 15px;">ID</th>
                        <th style="padding: 15px;">Fecha</th>
                        <th style="padding: 15px;">Escuela</th>
                        <th style="padding: 15px;">Material</th>
                        <th style="padding: 15px;">Cantidad</th>
                        <th style="padding: 15px;">Solicitante</th>
                        <th style="padding: 15px;">Estado</th>
                        <th style="padding: 15px;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="pedidosTableBody">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                            <p>Cargando pedidos...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal para ver/responder pedido -->
<div class="modal" id="pedidoModal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3 id="pedidoModalTitle">Detalles del Pedido</h3>
            <button class="modal-close" id="pedidoModalClose">&times;</button>
        </div>
        <div id="pedidoModalContent" style="padding: 20px;">
            <!-- Contenido din√°mico -->
        </div>
    </div>
</div>
<!-- ============================================ -->
<!-- SECCI√ìN REPORTES PARA ADMIN -->
<!-- ============================================ -->
<div id="section-reportes" class="dashboard-section">
    <div class="content-header">
        <h2><i class="fas fa-chart-bar"></i> Reportes e Informes</h2>
        <div class="date-display" id="reportDate">{{ now|date:"l, d F Y" }}</div>
    </div>
    
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon blue">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalMaterialesReport">{{ total_materiales|default:0 }}</h3>
                <p>Materiales Totales</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon green">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalMovimientosReport">0</h3>
                <p>Movimientos</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon orange">
                <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalPedidosReport">0</h3>
                <p>Pedidos</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon red">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="stat-info">
                <h3 id="totalAlertasReport">0</h3>
                <p>Alertas</p>
            </div>
        </div>
    </div>
    
    <div class="section-container">
        <div class="section-header">
            <h3><i class="fas fa-file-pdf"></i> Generar Nuevo Reporte</h3>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="reportType">Tipo de Reporte</label>
                <select id="reportType" class="form-control">
                    <option value="inventario">üì¶ Inventario General</option>
                    <option value="consumo">üìä Consumo por Per√≠odo</option>
                    <option value="pedidos">üìã Historial de Pedidos</option>
                    <option value="alertas">‚ö†Ô∏è Reporte de Alertas</option>
                </select>
            </div>
            <div class="form-group">
                <label for="reportPeriod">Per√≠odo</label>
                <select id="reportPeriod" class="form-control">
                    <option value="mes">√öltimo Mes</option>
                    <option value="trimestre">√öltimo Trimestre</option>
                    <option value="semestre">√öltimo Semestre</option>
                    <option value="anual">√öltimo A√±o</option>
                </select>
            </div>
        </div>
        <div class="form-buttons" style="margin-top: 20px;">
            <button class="btn-submit" id="generateReportBtn">
                <i class="fas fa-file-alt"></i> Generar Reporte
            </button>
            <button class="btn-action secondary" id="exportReportBtn">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
        </div>
    </div>
    
    <!-- Vista previa del reporte -->
    <div class="section-container" id="reportPreviewContainer" style="display: none;">
        <div class="section-header">
            <h3 id="reportPreviewTitle">Vista Previa del Reporte</h3>
            <button class="btn-action secondary" id="closePreviewBtn">
                <i class="fas fa-times"></i> Cerrar
            </button>
        </div>
        <div id="reportPreview" style="max-height: 400px; overflow-y: auto;">
            <!-- Contenido din√°mico -->
        </div>
    </div>
</div>

                <!-- ============================================ -->
                <!-- SECCI√ìN USUARIOS - CON TABLA RESPONSIVA -->
                <!-- ============================================ -->
                <div id="section-usuarios" class="dashboard-section">
                    <div class="content-header">
                        <h2>Gesti√≥n de Usuarios</h2>
                        <button class="btn-action primary" id="addUserBtn">
                            <i class="fas fa-plus"></i>
                            <span>Nuevo Usuario</span>
                        </button>
                    </div>

                    <!-- Tarjetas de estad√≠sticas compactas -->
                    <div class="stats-cards-mini"
                        style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                        <div
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 10px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <i class="fas fa-users" style="font-size: 2rem; opacity: 0.8;"></i>
                                </div>
                                <div style="text-align: right;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">{{ usuarios.count|default:0 }}</h3>
                                    <p style="margin: 0; opacity: 0.9;">Total</p>
                                </div>
                            </div>
                        </div>

                        <div
                            style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5253 100%); padding: 15px; border-radius: 10px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <i class="fas fa-user-tie" style="font-size: 2rem; opacity: 0.8;"></i>
                                </div>
                                <div style="text-align: right;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">{{ usuarios_administradores|default:0 }}</h3>
                                    <p style="margin: 0; opacity: 0.9;">Admins</p>
                                </div>
                            </div>
                        </div>

                        <div
                            style="background: linear-gradient(135deg, #48c774 0%, #00d68f 100%); padding: 15px; border-radius: 10px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <i class="fas fa-user-graduate" style="font-size: 2rem; opacity: 0.8;"></i>
                                </div>
                                <div style="text-align: right;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">{{ usuarios_escuelas|default:0 }}</h3>
                                    <p style="margin: 0; opacity: 0.9;">Escuelas</p>
                                </div>
                            </div>
                        </div>

                        <div
                            style="background: linear-gradient(135deg, #ffb822 0%, #f39c12 100%); padding: 15px; border-radius: 10px; color: white;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <i class="fas fa-user-clock" style="font-size: 2rem; opacity: 0.8;"></i>
                                </div>
                                <div style="text-align: right;">
                                    <h3 style="margin: 0; font-size: 1.8rem;">{{ usuarios_activos|default:0 }}</h3>
                                    <p style="margin: 0; opacity: 0.9;">Activos</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filtros compactos -->
                    <div
                        style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="flex: 2; min-width: 200px;">
                            <input type="text" id="searchUsers" class="filter-input"
                                placeholder="üîç Buscar por nombre, usuario o email..."
                                style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <select id="filterUserRole" class="filter-select"
                                style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                                <option value="">Todos los roles</option>
                                <option value="ADMIN">üëë Administradores</option>
                                <option value="ESCUELA">üè´ Usuarios Escuela</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <select id="filterUserStatus" class="filter-select"
                                style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                                <option value="">Todos los estados</option>
                                <option value="true">‚úÖ Activos</option>
                                <option value="false">‚ùå Inactivos</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <select id="filterUserSchool" class="filter-select"
                                style="width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
                                <option value="">Todas las escuelas</option>
                                {% for escuela in escuelas %}
                                    <option value="{{ escuela.id }}">{{ escuela.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <!-- Contenedor con scroll para la tabla -->
                    <div class="section-container"
                        style="padding: 0; overflow: hidden; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="overflow-x: auto; max-width: 100%;">
                            <div style="min-width: 1200px;">
                                <!-- Ancho m√≠nimo para evitar que se compriman las columnas -->
                                <table id="usersTable" style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                                    <thead
                                        style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); position: sticky; top: 0; z-index: 10;">
                                        <tr>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">ID</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Usuario</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Nombre</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Apellido</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Email</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Rol</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Escuela</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Tel√©fono</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Estado</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">√öltimo Acceso</th>
                                            <th style="padding: 15px 10px; text-align: left; border-bottom: 2px solid #dee2e6;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersTableBody">
                                        {% for usuario in usuarios %}
                                            <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s;"
                                                onmouseover="this.style.backgroundColor='#f8f9fa'"
                                                onmouseout="this.style.backgroundColor='transparent'">
                                                <td style="padding: 12px 10px;"><span
                                                        style="background: #6c757d; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">USER{{ usuario.id }}</span>
                                                </td>
                                                <td style="padding: 12px 10px; font-weight: 600;">{{ usuario.username }}</td>
                                                <td style="padding: 12px 10px;">{{ usuario.first_name|default:"-" }}</td>
                                                <td style="padding: 12px 10px;">{{ usuario.last_name|default:"-" }}</td>
                                                <td style="padding: 12px 10px;">
                                                    <span style="color: #007bff; text-decoration: none;">
                                                        <i class="fas fa-envelope"
                                                            style="font-size: 0.8rem; margin-right: 5px;"></i>{{ usuario.email|default:"-" }}
                                                    </span>
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    {% if usuario.rol == 'ADMIN' %}
                                                        <span
                                                            style="background: #cce5ff; color: #004085; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-block;">
                                                            <i class="fas fa-crown" style="margin-right: 5px;"></i>Administrador
                                                        </span>
                                                    {% else %}
                                                        <span
                                                            style="background: #d4edda; color: #155724; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: inline-block;">
                                                            <i class="fas fa-school" style="margin-right: 5px;"></i>Escuela
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    {% if usuario.admin_of %}
                                                        <span
                                                            style="background: #e2e3e5; color: #383d41; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                                            <i class="fas fa-map-marker-alt"></i> {{ usuario.admin_of.name }}
                                                        </span>
                                                    {% else %}
                                                        <span style="color: #6c757d;"><i class="fas fa-globe"></i> Sistema</span>
                                                    {% endif %}
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    {% if usuario.nro_tlf %}
                                                        <span
                                                            style="background: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                                                            <i class="fas fa-phone"></i> {{ usuario.nro_tlf }}
                                                        </span>
                                                    {% else %}
                                                        <span style="color: #adb5bd;">-</span>
                                                    {% endif %}
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    {% if usuario.is_active %}
                                                        <span
                                                            style="background: #d4edda; color: #155724; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                                                            <i class="fas fa-check-circle"></i> Activo
                                                        </span>
                                                    {% else %}
                                                        <span
                                                            style="background: #f8d7da; color: #721c24; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;">
                                                            <i class="fas fa-times-circle"></i> Inactivo
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    {% if usuario.last_login %}
                                                        <span style="color: #6c757d; font-size: 0.85rem;">
                                                            <i class="fas fa-clock"></i> {{ usuario.last_login|date:"d/m/Y H:i" }}
                                                        </span>
                                                    {% else %}
                                                        <span style="color: #adb5bd; font-size: 0.85rem;">
                                                            <i class="fas fa-hourglass"></i> Nunca
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td style="padding: 12px 10px;">
                                                    <div style="display: flex; gap: 5px;">
                                                        <button class="action-btn edit" data-id="{{ usuario.id }}"
                                                            title="Editar usuario"
                                                            style="background: #007bff; border: none; color: white; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="action-btn delete" data-id="{{ usuario.id }}"
                                                            title="Eliminar usuario"
                                                            style="background: #dc3545; border: none; color: white; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                        {% if usuario.is_active %}
                                                            <button class="action-btn view" data-id="{{ usuario.id }}"
                                                                title="Desactivar usuario"
                                                                style="background: #ffc107; border: none; color: #212529; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                                <i class="fas fa-ban"></i>
                                                            </button>
                                                        {% else %}
                                                            <button class="action-btn view" data-id="{{ usuario.id }}"
                                                                title="Activar usuario"
                                                                style="background: #28a745; border: none; color: white; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                                <i class="fas fa-check-circle"></i>
                                                            </button>
                                                        {% endif %}
                                                    </div>
                                                </td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="11" style="text-align: center; padding: 60px 20px;">
                                                    <div style="text-align: center;">
                                                        <i class="fas fa-users"
                                                            style="font-size: 4rem; color: #dee2e6; margin-bottom: 20px;"></i>
                                                        <h3 style="color: #6c757d; margin-bottom: 10px;">No hay usuarios registrados</h3>
                                                        <p style="color: #adb5bd;">Haz clic en "Nuevo Usuario" para comenzar</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Informaci√≥n de paginaci√≥n (opcional) -->
                        <div
                            style="padding: 15px 20px; background: #f8f9fa; border-top: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;">
                            <div>
                                <span style="color: #6c757d;">
                                    <i class="fas fa-database"></i> Total: <strong>{{ usuarios.count|default:0 }}</strong> usuarios
                                </span>
                            </div>
                            <div>
                                <span style="color: #6c757d;">
                                    <i class="fas fa-check-circle" style="color: #28a745;"></i> Activos:
                                    <strong>{{ usuarios_activos|default:0 }}</strong>
                                    <span style="margin: 0 10px;">|</span>
                                    <i class="fas fa-times-circle" style="color: #dc3545;"></i> Inactivos:
                                    <strong>{{ usuarios_inactivos|default:0 }}</strong>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario para agregar/editar usuario (compacto) -->
                    <div class="form-container" id="userForm"
                        style="display: none; margin-top: 30px; background: white; border-radius: 10px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3 id="userFormTitle"
                            style="margin-top: 0; margin-bottom: 20px; color: #343a40; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                            <i class="fas fa-user-plus" style="margin-right: 10px;"></i> Nuevo Usuario
                        </h3>
                        <form id="userFormElement" method="post" action="#">
                            {% csrf_token %}

                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                <div class="form-group">
                                    <label for="username"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-user"></i> Usuario *
                                    </label>
                                    <input type="text" id="username" name="username" required placeholder="ej: jperez"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>

                                <div class="form-group">
                                    <label for="email"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-envelope"></i> Email *
                                    </label>
                                    <input type="email" id="email" name="email" required placeholder="usuario@ejemplo.com"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>

                                <div class="form-group">
                                    <label for="first_name"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-user-tag"></i> Nombre
                                    </label>
                                    <input type="text" id="first_name" name="first_name" placeholder="Juan"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>

                                <div class="form-group">
                                    <label for="last_name"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-user-tag"></i> Apellido
                                    </label>
                                    <input type="text" id="last_name" name="last_name" placeholder="P√©rez"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>

                                <div class="form-group">
                                    <label for="userRole"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-user-shield"></i> Rol *
                                    </label>
                                    <select id="userRole" name="rol" required
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                        <option value="">Seleccionar rol</option>
                                        {% for rol_value, rol_label in CustomUser.Rol.choices %}
                                            <option value="{{ rol_value }}">{{ rol_label }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="userSchool"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-school"></i> Escuela
                                    </label>
                                    <select id="userSchool" name="admin_of"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                        <option value="">Ninguna (Sistema)</option>
                                        {% for escuela in escuelas %}
                                            <option value="{{ escuela.id }}">{{ escuela.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="nro_tlf"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-phone"></i> Tel√©fono
                                    </label>
                                    <input type="text" id="nro_tlf" name="nro_tlf" placeholder="04121234567"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>

                                <div class="form-group">
                                    <label for="is_active"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-toggle-on"></i> Estado
                                    </label>
                                    <select id="is_active" name="is_active"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                        <option value="true">Activo</option>
                                        <option value="false">Inactivo</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="password"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-lock"></i> Contrase√±a
                                    </label>
                                    <input type="password" id="password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                    <small style="color: #6c757d; display: block; margin-top: 5px;">Dejar en blanco para no
                                        cambiar</small>
                                </div>

                                <div class="form-group">
                                    <label for="confirm_password"
                                        style="display: block; margin-bottom: 5px; font-weight: 600; color: #495057;">
                                        <i class="fas fa-lock"></i> Confirmar
                                    </label>
                                    <input type="password" id="confirm_password" name="confirm_password"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 5px;">
                                </div>
                            </div>

                            <div
                                style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 25px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                                <button type="button" class="btn-cancel" id="cancelUserBtn"
                                    style="padding: 10px 25px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                                <button type="submit" class="btn-submit" id="saveUserBtn"
                                    style="padding: 10px 25px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-save"></i> Guardar Usuario
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCI√ìN ESCUELAS -->
                <!-- ============================================ -->
                <div id="section-escuelas" class="dashboard-section">
                    <div class="content-header">
                        <h2>Gesti√≥n de Escuelas</h2>
                        <button class="btn-action primary" id="addSchoolBtn">
                            <i class="fas fa-plus"></i>
                            <span>Nueva Escuela</span>
                        </button>
                    </div>

                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ total_escuelas }}</h3>
                                <p>Escuelas Activas</p>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3>{{ usuarios.count }}</h3>
                                <p>Usuarios Totales</p>
                            </div>
                        </div>
                    </div>

                    <div class="section-container">
                        <table id="schoolsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Ubicaci√≥n</th>
                                    <th>Usuarios</th>
                                    <th>Materiales</th>
                                    <th>Tipo</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="schoolsTableBody">
                                {% for escuela in escuelas %}
                                    <tr>
                                        <td>{{ escuela.id }}</td>
                                        <td>{{ escuela.name }}</td>
                                        <td>{{ escuela.ubic|default:"No especificada" }}</td>
                                        <td>{{ escuela.usuarios_count|default:0 }}</td>
                                        <td>{{ escuela.materiales_count|default:0 }}</td>
                                        <td>
                                            <span class="status-badge status-in-stock">
                                                {{ escuela.es_depo|yesno:"Dep√≥sito,Escuela" }}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="action-btn edit" data-id="{{ escuela.id }}">Editar</button>
                                            <button class="action-btn delete" data-id="{{ escuela.id }}">Eliminar</button>
                                            <button class="action-btn view" data-id="{{ escuela.id }}">Ver</button>
                                        </td>
                                    </tr>
                                {% empty %}
                                    <tr>
                                        <td colspan="7" style="text-align: center; padding: 20px; color: #6c757d;">
                                            No hay escuelas registradas
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCI√ìN CONFIGURACI√ìN -->
                <!-- ============================================ -->
                <div id="section-configuracion" class="dashboard-section">
                    <div class="content-header">
                        <h2>Configuraci√≥n del Sistema</h2>
                    </div>

                    <div class="section-container">
                        <h3>Configuraci√≥n General</h3>
                        <form id="generalSettingsForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="systemName">Nombre del Sistema</label>
                                    <input type="text" id="systemName" value="Luth Inv.">
                                </div>
                                <div class="form-group">
                                    <label for="systemEmail">Email del Sistema</label>
                                    <input type="email" id="systemEmail" value="soporte@luthinv.com">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="lowStockThreshold">Umbral de Stock Bajo (%)</label>
                                    <input type="number" id="lowStockThreshold" min="1" max="100" value="20">
                                </div>
                                <div class="form-group">
                                    <label for="criticalStockThreshold">Umbral de Stock Cr√≠tico (%)</label>
                                    <input type="number" id="criticalStockThreshold" min="1" max="100" value="10">
                                </div>
                            </div>

                            <div class="form-buttons">
                                <button type="submit" class="btn-submit">Guardar Configuraci√≥n</button>
                            </div>
                        </form>
                    </div>

                    <div class="section-container">
                        <div class="section-header">
                            <h3>Respaldo y Mantenimiento</h3>
                        </div>
                        <div class="form-buttons" style="justify-content: flex-start; gap: 15px;">
                            <button class="btn-action primary" id="backupBtn">
                                <i class="fas fa-database"></i>
                                <span>Crear Respaldo</span>
                            </button>
                            <button class="btn-action secondary" id="clearCacheBtn">
                                <i class="fas fa-broom"></i>
                                <span>Limpiar Cach√©</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="dashboard-footer">
            <div class="footer-content">
                <div class="footer-copyright">
                    ¬© 2024 Luth Inv. - Sistema de Inventario. v1.2.0
                </div>
                <div class="footer-links">
                    <a href="#">Soporte</a>
                    <a href="#">Documentaci√≥n</a>
                    <a href="#">Pol√≠tica de Privacidad</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modales -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detalles</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Contenido din√°mico -->
            </div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmModalTitle">Confirmar Acci√≥n</h3>
                <button class="modal-close" id="confirmModalClose">&times;</button>
            </div>
            <div id="confirmModalContent">
                <!-- Contenido din√°mico -->
            </div>
            <div class="form-buttons" style="margin-top: 20px;">
                <button type="button" class="btn-cancel" id="confirmCancelBtn">Cancelar</button>
                <button type="button" class="btn-submit" id="confirmActionBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Pasar datos de Django a JavaScript -->
    <script>
        window.djangoData = {{ data_json|safe }};
        window.userData = {
            id: {{ user.id }},
            username: "{{ user.username|escapejs }}",
            name: "{{ user.first_name|escapejs }} {{ user.last_name|escapejs }}",
            email: "{{ user.email|escapejs }}",
            rol: "{{ user.rol|escapejs }}",
            rol_display: "{{ user.get_rol_display|escapejs }}"
        };
    </script>

    <!-- Formulario oculto para logout (alternativo) -->
    <form id="logoutForm" action="{% url 'logout' %}" method="post" style="display: none;">
        {% csrf_token %}
    </form>

    <script src="{% static 'js/dashboard.js' %}"></script>
</body>
</html>